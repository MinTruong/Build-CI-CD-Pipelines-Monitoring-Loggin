---
# - name: "upgrade packages."
#   become: true
#   apt:
#     upgrade: "yes"

- name: "install dependencies."
  become: true
  apt:
    name: ["nodejs", "npm", "tar", "pm2"]
    state: latest
    update_cache: yes

# - name: "create direction"
#   become: true
#   file:
#     path: /home/app
#     state: directory
#     mode: 0755

# - name: "Copy zip into EC2"
#   become: true
#   copy:
#     src: /root/project/artifact.tar.gz
#     dest: /home/app/artifact.tar.gz

# - name: unzip
#   become: true
#   shell: |
#     cd /home/app
#     tar -vxf artifact.tar.gz

- name: build and start node
  become: true
  shell: 
    cmd: |
      cd /home/app
      pm2 stop default
      pm2 start npm -- start